<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MTK Coin Miner - Mobile Ready</title>
    <style>
        :root {
            --primary: #f8c555;
            --primary-dark: #e6b142;
            --secondary: #667eea;
            --secondary-dark: #5a67d8;
            --success: #2ed573;
            --error: #ff4757;
            --warning: #ffa502;
            --info: #1e90ff;
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --light-text: #ffffff;
            --gray-text: #a0aec0;
            --card-bg: rgba(0, 0, 0, 0.7);
            --glass-effect: backdrop-filter: blur(10px);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
            --border-radius: 15px;
            --border-radius-sm: 8px;
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--secondary) 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: var(--light-text);
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            line-height: 1.5;
            overflow-x: hidden;
            position: relative;
        }

        /* Mobile-first responsive design */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .main-layout {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 15px 0;
        }

        @media (min-width: 768px) {
            .main-layout {
                flex-direction: row;
            }
            
            .game-column {
                flex: 2;
            }
            
            .wallet-column {
                flex: 1;
                min-width: 320px;
                max-width: 400px;
            }
        }

        .section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: clamp(15px, 4vw, 25px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Responsive Typography */
        h1 {
            text-align: center;
            margin-bottom: clamp(15px, 3vw, 30px);
            color: var(--primary);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 800;
            line-height: 1.2;
        }

        h2 {
            color: var(--primary);
            margin-bottom: clamp(12px, 2vw, 20px);
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        h3 {
            color: var(--primary);
            margin: clamp(12px, 2vw, 20px) 0 clamp(8px, 1.5vw, 15px);
            font-size: clamp(1.1rem, 3vw, 1.3rem);
            font-weight: 600;
        }

        /* Game Canvas - Responsive */
        .game-container {
            position: relative;
            background: var(--darker-bg);
            border: 3px solid var(--primary);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            margin-bottom: clamp(15px, 3vw, 25px);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
            width: 100%;
            aspect-ratio: 16/9; /* Maintain aspect ratio */
            max-height: 70vh; /* Limit height on desktop */
        }

        #gameCanvas {
            display: block;
            background: var(--dark-bg);
            width: 100%;
            height: 100%;
            touch-action: manipulation; /* Prevent scrolling on canvas */
        }

        /* Mobile-specific game container */
        @media (max-width: 767px) {
            .game-container {
                aspect-ratio: 4/3; /* Better for mobile */
                max-height: 60vh;
            }
        }

        @media (max-width: 480px) {
            .game-container {
                aspect-ratio: 3/4; /* Portrait mode */
                max-height: 50vh;
            }
        }

        /* Responsive Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
            gap: 10px;
            margin-top: clamp(15px, 3vw, 20px);
        }

        @media (max-width: 480px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #000;
            border: none;
            padding: clamp(12px, 3vw, 15px) clamp(15px, 4vw, 20px);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(14px, 3vw, 15px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--shadow);
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(248, 197, 85, 0.4);
            background: linear-gradient(135deg, var(--primary-dark), #d4a52e);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #25c164);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e59400);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error), #e84151);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #187bcd);
        }

        /* Responsive Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(120px, 100%), 1fr));
            gap: clamp(8px, 2vw, 15px);
            margin-top: clamp(12px, 2vw, 20px);
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: rgba(248, 197, 85, 0.15);
            border-radius: var(--border-radius-sm);
            padding: clamp(15px, 3vw, 20px);
            text-align: center;
            border: 1px solid rgba(248, 197, 85, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: clamp(20px, 5vw, 28px);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: clamp(11px, 2.5vw, 13px);
            color: var(--gray-text);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive Wallet Info */
        .wallet-card {
            background: rgba(248, 197, 85, 0.1);
            border: 2px solid var(--primary);
            border-radius: var(--border-radius-sm);
            padding: clamp(15px, 3vw, 20px);
            margin-bottom: clamp(15px, 3vw, 25px);
        }

        .info-grid {
            display: grid;
            gap: clamp(8px, 2vw, 12px);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(10px, 2vw, 12px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-sm);
            transition: background 0.3s ease;
            flex-wrap: wrap;
            gap: 5px;
        }

        .label {
            color: var(--primary);
            font-weight: 600;
            font-size: clamp(12px, 2.5vw, 14px);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .value {
            color: var(--light-text);
            font-family: 'Courier New', monospace;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: 500;
            word-break: break-all;
            text-align: right;
        }

        /* Token Actions - Mobile Friendly */
        .token-actions {
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 2vw, 15px);
            margin-top: clamp(15px, 3vw, 25px);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        input {
            padding: clamp(12px, 3vw, 14px);
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--primary);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light-text);
            font-size: clamp(14px, 3vw, 16px);
            transition: all 0.3s ease;
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
        }

        /* Transaction Panels */
        .transaction-panel, .gas-panel, .event-panel {
            padding: clamp(15px, 3vw, 20px);
            border-radius: var(--border-radius-sm);
            margin: clamp(10px, 2vw, 20px) 0;
            font-size: clamp(13px, 2.5vw, 14px);
            line-height: 1.5;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100px, 100%), 1fr));
            gap: clamp(10px, 2vw, 15px);
            margin-top: clamp(10px, 2vw, 15px);
        }

        /* Notifications - Mobile Optimized */
        .notification {
            position: fixed;
            top: max(25px, env(safe-area-inset-top));
            right: 15px;
            left: 15px;
            padding: 15px 20px;
            background: var(--primary);
            color: #000;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            transform: translateY(-150%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary-dark);
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .notification.show {
            transform: translateY(0);
        }

        @media (min-width: 768px) {
            .notification {
                left: auto;
                right: 25px;
                width: auto;
            }
        }

        /* Pending Overlay - Full Screen Mobile */
        .pending-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
        }

        .pending-spinner {
            width: clamp(60px, 15vw, 80px);
            height: clamp(60px, 15vw, 80px);
            border: 4px solid rgba(248, 197, 85, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: clamp(15px, 4vw, 25px);
        }

        .pending-text {
            font-size: clamp(18px, 4vw, 22px);
            color: var(--primary);
            margin-bottom: clamp(10px, 3vw, 15px);
            font-weight: 600;
        }

        /* Connection Screen - Mobile Optimized */
        .connection-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
            min-height: -webkit-fill-available;
            text-align: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            margin: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            gap: clamp(15px, 4vw, 25px);
        }

        .metamask-icon {
            font-size: clamp(60px, 15vw, 80px);
            margin-bottom: clamp(15px, 4vw, 30px);
            color: var(--primary);
            animation: float 3s ease-in-out infinite;
        }

        .connection-steps {
            background: rgba(248, 197, 85, 0.1);
            border-radius: var(--border-radius-sm);
            padding: clamp(15px, 4vw, 25px);
            margin: clamp(10px, 3vw, 25px) 0;
            width: 100%;
            max-width: 500px;
        }

        .step {
            display: flex;
            align-items: center;
            margin: clamp(10px, 2vw, 15px) 0;
            padding: clamp(12px, 3vw, 15px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-sm);
            transition: transform 0.3s ease;
        }

        .step:hover {
            transform: translateX(5px);
        }

        .step-number {
            background: var(--primary);
            color: #000;
            width: clamp(28px, 7vw, 32px);
            height: clamp(28px, 7vw, 32px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: clamp(10px, 3vw, 15px);
            font-weight: 700;
            flex-shrink: 0;
            font-size: clamp(14px, 3.5vw, 16px);
        }

        .big-connect-btn {
            padding: clamp(18px, 4vw, 22px) clamp(30px, 6vw, 45px);
            font-size: clamp(16px, 4vw, 20px);
            margin: clamp(15px, 4vw, 25px) 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: var(--border-radius-sm);
            color: #000;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-lg);
            width: auto;
        }

        /* Mobile-specific adjustments */
        @media (max-width: 480px) {
            .big-connect-btn {
                width: 100%;
                justify-content: center;
            }
            
            .connection-screen {
                margin: 5px;
                padding: 15px;
            }
        }

        /* Touch-friendly elements */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }

        /* Hide elements on very small screens */
        @media (max-width: 320px) {
            .stat-label {
                font-size: 10px;
            }
            
            .label, .value {
                font-size: 11px;
            }
        }

        /* Landscape mode optimizations */
        @media (orientation: landscape) and (max-height: 600px) {
            .connection-screen {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-around;
                padding: 10px;
            }
            
            .game-container {
                aspect-ratio: 16/9;
                max-height: 50vh;
            }
            
            .main-layout {
                flex-direction: row;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; box-shadow: 0 0 20px var(--primary); }
            50% { transform: scale(1.3); opacity: 1; box-shadow: 0 0 40px var(--primary); }
            100% { transform: scale(1); opacity: 0.8; box-shadow: 0 0 20px var(--primary); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .mobile-only {
            display: block;
        }

        .desktop-only {
            display: none;
        }

        @media (min-width: 768px) {
            .mobile-only {
                display: none;
            }
            
            .desktop-only {
                display: block;
            }
        }

        /* Contract Modal - Mobile Responsive */
        #contractModal {
            overflow-y: auto;
            padding: clamp(20px, 5vw, 40px);
        }

        #contractModal > div {
            max-width: min(900px, 100%);
            width: 100%;
            margin: 0 auto;
        }

        /* Mobile Navigation Button */
        .mobile-nav-btn {
            position: fixed;
            bottom: max(20px, env(safe-area-inset-bottom));
            right: 20px;
            background: var(--primary);
            color: #000;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            border: none;
            cursor: pointer;
        }

        @media (min-width: 768px) {
            .mobile-nav-btn {
                display: none;
            }
        }

        /* Safe area handling for iPhone X+ */
        @supports (padding: max(0px)) {
            body {
                padding-left: min(0px, env(safe-area-inset-left));
                padding-right: min(0px, env(safe-area-inset-right));
            }
        }

        /* Prevent text size adjustment on orientation change */
        html {
            -webkit-text-size-adjust: 100%;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Improve tap targets on mobile */
        button, 
        input[type="button"], 
        input[type="submit"] {
            touch-action: manipulation;
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation Button -->
    <button class="mobile-nav-btn hidden" id="mobileNavBtn" onclick="scrollToTop()">
        ‚Üë
    </button>

    <div id="pendingOverlay" class="pending-overlay hidden">
        <div class="pending-spinner"></div>
        <div class="pending-text" id="pendingText">Processing Transaction...</div>
        <div class="tx-hash" id="pendingTxHash">Tx Hash: Loading...</div>
        <div class="gas-panel" id="pendingGasInfo">‚õΩ Gas: Estimating...</div>
        <div style="color: var(--gray-text); margin-top: 20px; text-align: center; max-width: 400px;">
            ‚è≥ Transaction is being processed<br>
            This usually takes 15-45 seconds
        </div>
        <button class="btn btn-danger" onclick="hidePendingOverlay()" style="margin-top: 20px;">
            Cancel
        </button>
    </div>
    
    <div id="connectionScreen" class="connection-screen">
        <div class="metamask-icon">ü¶ä</div>
        <div style="width: 100%;">
            <h1>üöÄ MTK Coin Miner</h1>
            <p style="color: var(--gray-text); margin-bottom: 10px; font-size: clamp(14px, 3.5vw, 18px);">
                Play & Earn on Blockchain
            </p>
        </div>
        
        <div class="connection-steps">
            <div class="step">
                <div class="step-number">1</div>
                <div style="text-align: left;">
                    <strong>Install MetaMask</strong><br>
                    <span style="color: var(--gray-text); font-size: clamp(12px, 2.5vw, 14px);">Browser extension/wallet</span>
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div style="text-align: left;">
                    <strong>Switch to Sepolia</strong><br>
                    <span style="color: var(--gray-text); font-size: clamp(12px, 2.5vw, 14px);">Test network for free ETH</span>
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div style="text-align: left;">
                    <strong>Get Test ETH</strong><br>
                    <span style="color: var(--gray-text); font-size: clamp(12px, 2.5vw, 14px);">From Sepolia faucet</span>
                </div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div style="text-align: left;">
                    <strong>Start Mining</strong><br>
                    <span style="color: var(--gray-text); font-size: clamp(12px, 2.5vw, 14px);">Earn MTK tokens!</span>
                </div>
            </div>
        </div>
        
        <button class="big-connect-btn" onclick="connectWallet()">
            <span>üîó</span> Connect Wallet
        </button>
        
        <div style="margin-top: 15px; color: var(--gray-text); font-size: clamp(12px, 2.5vw, 14px); max-width: 500px;">
            üí° <strong>Features:</strong> Gas estimation, live events, real-time updates
        </div>
        
        <div class="mobile-only" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            üì± <strong>Mobile Tips:</strong> Rotate to landscape for better game view
        </div>
    </div>
    
    <div id="gameScreen" class="hidden">
        <div class="container">
            <h1 style="padding: 0 10px;">
                ‚õèÔ∏è MTK Miner 
                <span style="font-size: 0.8rem; color: var(--primary); background: rgba(248, 197, 85, 0.2); padding: 4px 10px; border-radius: 20px; margin-left: 5px;">
                    LIVE
                </span>
            </h1>
            
            <div class="main-layout">
                <div class="game-column">
                    <div class="section">
                        <h2>üéÆ Mining Game</h2>
                        
                        <div class="game-container">
                            <canvas id="gameCanvas"></canvas>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="score">0</div>
                                <div class="stat-label">MTK Mined</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="multiplier">1x</div>
                                <div class="stat-label">Power</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="miners">1</div>
                                <div class="stat-label">Miners</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="speed">1.0</div>
                                <div class="stat-label">Speed</div>
                            </div>
                        </div>
                        
                        <div class="controls-grid">
                            <button onclick="upgradeMiningPower()" class="btn">
                                ‚¨ÜÔ∏è Upgrade
                            </button>
                            <button onclick="buyMiner()" class="btn">
                                üë∑ Buy Miner
                            </button>
                            <button onclick="upgradeSpeed()" class="btn">
                                ‚ö° Speed Up
                            </button>
                            <button onclick="estimateClaimGas()" id="claimBtn" class="btn btn-success">
                                üí∞ Claim MTK
                            </button>
                        </div>
                        
                        <div class="mobile-only" style="margin-top: 15px; text-align: center; color: var(--gray-text); font-size: 12px;">
                            üí° Tap the golden spots to mine coins!
                        </div>
                    </div>
                </div>
                
                <div class="wallet-column">
                    <div class="section">
                        <h2>üëõ Wallet</h2>
                        
                        <div class="wallet-card">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="label">Status</span>
                                    <span class="value highlight" id="walletStatus">Connected</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Account</span>
                                    <span class="value" id="accountAddress">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Network</span>
                                    <span class="value" id="network">Sepolia</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Block</span>
                                    <span class="value" id="lastBlock">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="transaction-panel">
                            <h3>üìä Transactions</h3>
                            <div class="status-grid">
                                <div class="status-item">
                                    <div class="stat-label">Pending</div>
                                    <div class="stat-value" id="pendingCount">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="stat-label">Confirmed</div>
                                    <div class="stat-value" id="confirmedCount">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="disconnectWallet()" class="btn btn-danger" style="width: 100%; margin-bottom: 15px;">
                            üîì Disconnect
                        </button>
                        
                        <div class="wallet-card">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="label">Game Balance</span>
                                    <span class="value highlight" id="gameBalance">0 MTK</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Claimed</span>
                                    <span class="value" id="claimedBalance">0 MTK</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">ETH Balance</span>
                                    <span class="value" id="ethBalance">0 ETH</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="token-actions">
                            <div class="gas-panel" id="claimGasInfo">
                                Click "Claim MTK" to estimate gas
                            </div>
                            
                            <button onclick="estimateClaimGas()" id="estimateClaimBtn" class="btn btn-success">
                                üí∞ Claim MTK
                            </button>
                            
                            <div class="input-group">
                                <label class="input-label">Withdraw Amount (MTK)</label>
                                <input type="number" id="withdrawAmount" placeholder="Enter amount" value="100" min="1">
                            </div>
                            
                            <div class="gas-panel" id="withdrawGasInfo">
                                Enter amount to estimate gas
                            </div>
                            
                            <button onclick="estimateWithdrawGas()" id="estimateWithdrawBtn" class="btn btn-warning">
                                üè¶ Withdraw
                            </button>
                            
                            <button onclick="checkAllBalances()" class="btn btn-info">
                                üîÑ Refresh
                            </button>
                            
                            <button onclick="showContractModal()" class="btn" style="margin-top: 10px;">
                                üìú View Contract
                            </button>
                        </div>
                        
                        <div class="event-panel">
                            <h3>üîî Live Events</h3>
                            <div class="status-grid">
                                <div class="status-item">
                                    <div class="stat-label">Blocks</div>
                                    <div class="stat-value" id="blocksMined">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="stat-label">Updates</div>
                                    <div class="stat-value" id="balanceUpdates">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <!-- Contract Modal -->
    <div id="contractModal" class="pending-overlay hidden">
        <div style="background: var(--dark-bg); border-radius: var(--border-radius); padding: 20px; border: 2px solid var(--primary); max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: var(--primary); margin: 0; font-size: 1.3rem;">üìú Smart Contract</h2>
                <button onclick="closeContractModal()" class="btn btn-danger" style="padding: 8px 15px;">‚úï Close</button>
            </div>
            
            <pre style="background: #1e1e1e; border-radius: var(--border-radius-sm); padding: 15px; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.4; overflow-x: auto; color: #f8f8f2;">
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract MTKCoin is ERC20, Ownable {
    constructor() ERC20("Mining Token", "MTK") Ownable(msg.sender) {
        _mint(msg.sender, 1000000 * 10 ** decimals());
    }
    
    function mint(address to, uint256 amount) public onlyOwner {
        _mint(to, amount);
    }
}
            </pre>
            
            <div style="margin-top: 20px; color: var(--gray-text); font-size: 14px;">
                <p>üìã <strong>To Deploy:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Copy contract code</li>
                    <li>Go to remix.ethereum.org</li>
                    <li>Create file & paste code</li>
                    <li>Compile & deploy to Sepolia</li>
                    <li>Update address in game</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Auto-responsive canvas setup
        let canvas, ctx;
        let canvasWidth = 800;
        let canvasHeight = 500;
        
        // Game Variables
        let score = 0;
        let miningPower = 1;
        let miners = 1;
        let miningSpeed = 1.0;
        let gameInterval;
        let mineSpots = [];
        let totalMined = 0;
        let totalClaimed = 0;
        let totalWithdrawn = 0;
        let claimedBalance = 0;
        
        // Blockchain Variables
        let web3;
        let userAccount;
        let mtkContract;
        let connected = false;
        
        // Transaction Tracking
        let pendingTransactions = [];
        let confirmedTransactions = [];
        
        // Event Listener Counters
        let blocksMined = 0;
        let balanceUpdateCount = 0;
        
        // Contract Configuration
        const MTK_CONTRACT_ADDRESS = '0x3e622317f8C93f7328350cF0B56d9eD4C620C5d6';
        const MTK_CONTRACT_ABI = [/* Same ABI as before */];

        // Initialize Responsive Canvas
        function initResponsiveCanvas() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set initial size based on container
            const container = canvas.parentElement;
            canvasWidth = container.clientWidth;
            canvasHeight = container.clientHeight;
            
            // Set canvas size with device pixel ratio for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            canvas.width = canvasWidth * dpr;
            canvas.height = canvasHeight * dpr;
            ctx.scale(dpr, dpr);
            
            // Adjust canvas display size
            canvas.style.width = canvasWidth + 'px';
            canvas.style.height = canvasHeight + 'px';
            
            createMineSpots();
            
            // Handle window resize
            window.addEventListener('resize', handleResize);
            
            // Handle orientation change on mobile
            window.addEventListener('orientationchange', () => {
                setTimeout(handleResize, 100);
            });
        }

        function handleResize() {
            const container = canvas.parentElement;
            const newWidth = container.clientWidth;
            const newHeight = container.clientHeight;
            
            if (newWidth !== canvasWidth || newHeight !== canvasHeight) {
                canvasWidth = newWidth;
                canvasHeight = newHeight;
                
                const dpr = window.devicePixelRatio || 1;
                canvas.width = canvasWidth * dpr;
                canvas.height = canvasHeight * dpr;
                ctx.scale(dpr, dpr);
                
                canvas.style.width = canvasWidth + 'px';
                canvas.style.height = canvasHeight + 'px';
                
                // Recreate mine spots for new dimensions
                createMineSpots();
            }
        }

        function createMineSpots() {
            mineSpots = [];
            const spotCount = Math.max(3, Math.floor(canvasWidth * canvasHeight / 40000));
            
            for (let i = 0; i < spotCount; i++) {
                mineSpots.push({
                    x: Math.random() * (canvasWidth - 40) + 20,
                    y: Math.random() * (canvasHeight - 40) + 20,
                    active: true
                });
            }
        }

        function updateGame() {
            // Clear with gradient
            const gradient = ctx.createLinearGradient(0, 0, canvasWidth, canvasHeight);
            gradient.addColorStop(0, '#16213e');
            gradient.addColorStop(1, '#0f3460');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // Draw mine spots with responsive size
            const spotSize = Math.max(8, Math.min(15, canvasWidth / 50));
            
            mineSpots.forEach(spot => {
                if (spot.active) {
                    // Outer glow
                    ctx.shadowColor = '#f8c555';
                    ctx.shadowBlur = 20;
                    ctx.fillStyle = 'rgba(248, 197, 85, 0.8)';
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, spotSize + 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Inner core
                    ctx.shadowBlur = 0;
                    const gradient = ctx.createRadialGradient(
                        spot.x, spot.y, 0,
                        spot.x, spot.y, spotSize
                    );
                    gradient.addColorStop(0, '#ffdd59');
                    gradient.addColorStop(1, '#f8c555');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, spotSize, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // Auto mining with responsive rate
            const miningRate = Math.min(0.5, 0.3 * (canvasWidth / 800));
            mineSpots.forEach(spot => {
                if (spot.active && Math.random() < miningRate) {
                    const mined = miningPower * miners;
                    score += mined;
                    totalMined += mined;
                    updateStats();
                    showParticle(spot.x, spot.y);
                }
            });
        }

        function showParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'mine-spot';
            particle.style.left = (x - 12) + 'px';
            particle.style.top = (y - 12) + 'px';
            particle.style.animation = 'pulse 1s ease-out';
            document.querySelector('.game-container').appendChild(particle);
            
            setTimeout(() => particle.remove(), 1000);
        }

        // Touch and click handling
        function setupCanvasInteractions() {
            canvas.addEventListener('click', handleCanvasClick);
            canvas.addEventListener('touchstart', handleCanvasTouch, { passive: false });
        }

        function handleCanvasClick(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            handleMining(x, y);
        }

        function handleCanvasTouch(e) {
            e.preventDefault();
            if (e.touches.length > 0) {
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const x = (touch.clientX - rect.left) * scaleX;
                const y = (touch.clientY - rect.top) * scaleY;
                
                handleMining(x, y);
            }
        }

        function handleMining(x, y) {
            const clickRadius = Math.max(20, Math.min(40, canvasWidth / 20));
            
            mineSpots.forEach(spot => {
                const distance = Math.sqrt((x - spot.x) ** 2 + (y - spot.y) ** 2);
                if (distance < clickRadius && spot.active) {
                    const minedAmount = miningPower * 10;
                    score += minedAmount;
                    totalMined += minedAmount;
                    spot.active = false;
                    
                    // Particle explosion
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            showParticle(spot.x + Math.random() * 30 - 15, spot.y + Math.random() * 30 - 15);
                        }, i * 100);
                    }
                    
                    setTimeout(() => {
                        spot.active = true;
                        spot.x = Math.random() * (canvasWidth - 40) + 20;
                        spot.y = Math.random() * (canvasHeight - 40) + 20;
                    }, 1000);
                    
                    updateStats();
                    showNotification(`üéâ +${minedAmount} MTK!`, 'success');
                }
            });
        }

        // Game Functions
        function upgradeMiningPower() {
            if (score >= 100) {
                score -= 100;
                miningPower++;
                updateStats();
                showNotification('‚ö° Power upgraded!', 'success');
            } else {
                showNotification('üí∞ Need more MTK!', 'error');
            }
        }

        function buyMiner() {
            if (score >= 500) {
                score -= 500;
                miners++;
                updateStats();
                showNotification('üë∑ Miner hired!', 'success');
            } else {
                showNotification('üí∞ Need more MTK!', 'error');
            }
        }

        function upgradeSpeed() {
            if (score >= 250) {
                score -= 250;
                miningSpeed += 0.5;
                clearInterval(gameInterval);
                gameInterval = setInterval(updateGame, 1000 / miningSpeed);
                updateStats();
                showNotification('üöÄ Speed increased!', 'success');
            } else {
                showNotification('üí∞ Need more MTK!', 'error');
            }
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('gameBalance').textContent = `${score} MTK`;
            document.getElementById('claimedBalance').textContent = `${claimedBalance} MTK`;
            document.getElementById('multiplier').textContent = `${miningPower}x`;
            document.getElementById('miners').textContent = miners;
            document.getElementById('speed').textContent = miningSpeed.toFixed(1);
        }

        // Mobile Navigation
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show/hide mobile nav button based on scroll
        window.addEventListener('scroll', () => {
            const navBtn = document.getElementById('mobileNavBtn');
            if (window.scrollY > 200) {
                navBtn.classList.remove('hidden');
            } else {
                navBtn.classList.add('hidden');
            }
        });

        // Initialize game
        function initGame() {
            initResponsiveCanvas();
            setupCanvasInteractions();
            gameInterval = setInterval(updateGame, 1000 / miningSpeed);
            updateStats();
            
            // Show mobile tips
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    showNotification('üì± Tip: Tap golden spots to mine!', 'info');
                }, 2000);
            }
        }

        // Rest of the blockchain functions remain the same...
        // [Previous blockchain functions - connectWallet, estimateClaimGas, claimTokens, etc.]
        // They work the same way, just call them from the responsive buttons

        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showNotification('Install MetaMask first!', 'error');
                    window.open('https://metamask.io/download/', '_blank');
                    return;
                }

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length === 0) {
                    showNotification('Unlock MetaMask first!', 'error');
                    return;
                }
                
                web3 = new Web3(window.ethereum);
                userAccount = accounts[0];
                
                const chainId = await web3.eth.getChainId();
                
                if (chainId !== 11155111) {
                    showNotification('Switch to Sepolia Testnet', 'warning');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0xaa36a7' }],
                        });
                        setTimeout(() => location.reload(), 1000);
                        return;
                    } catch (switchError) {
                        console.log('Switch error:', switchError);
                    }
                }
                
                document.getElementById('accountAddress').textContent = 
                    `${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                
                connected = true;
                
                document.getElementById('connectionScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                
                initGame();
                
                showNotification('‚úÖ Wallet connected!', 'success');
                
            } catch (error) {
                showNotification('Connection failed', 'error');
            }
        }

        function disconnectWallet() {
            connected = false;
            web3 = null;
            userAccount = null;
            
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('connectionScreen').classList.remove('hidden');
            
            showNotification('Wallet disconnected', 'info');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            const colors = {
                'error': '#ff4757',
                'success': '#2ed573',
                'warning': '#ffa502',
                'info': '#1e90ff'
            };
            
            notification.style.background = colors[type] || '#f8c555';
            
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        function showContractModal() {
            document.getElementById('contractModal').classList.remove('hidden');
        }

        function closeContractModal() {
            document.getElementById('contractModal').classList.add('hidden');
        }

        function hidePendingOverlay() {
            document.getElementById('pendingOverlay').classList.add('hidden');
        }

        // Stub functions for demo
        async function estimateClaimGas() {
            showNotification('Feature coming soon!', 'info');
        }

        async function estimateWithdrawGas() {
            showNotification('Feature coming soon!', 'info');
        }

        async function checkAllBalances() {
            showNotification('Refreshing...', 'info');
        }

        // Initialize on load
        window.onload = function() {
            // Check if already connected
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            document.getElementById('connectionScreen').classList.add('hidden');
                            document.getElementById('gameScreen').classList.remove('hidden');
                            connectWallet();
                        }
                    });
            }
            
            // Handle mobile back button
            window.addEventListener('popstate', () => {
                if (connected) {
                    disconnectWallet();
                }
            });
        };
    </script>
    
    <!-- Include Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
</body>
</html>
